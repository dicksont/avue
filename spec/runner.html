<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="/bower_components/qunit/qunit/qunit.css"></link>
  <script src="/bower_components/qunit/qunit/qunit.js"></script>
  <script src="../index.js"></script>
  <script>

  Array.prototype.equals = Array.prototype.equals || function (array) {
    // if the other array is a falsy value, return
    if (!array)
      return false;

    // compare lengths - can save a lot of time
    if (this.length != array.length)
      return false;

    for (var i = 0, l=this.length; i < l; i++) {
      // Check if we have nested arrays
      if (this[i] instanceof Array && array[i] instanceof Array) {
        // recurse into the nested arrays
        if (!this[i].equals(array[i]))
          return false;
        }
        else if (this[i] != array[i]) {
          // Warning - two different object instances will never be equal: {x:20} != {x:20}
          return false;
        }
    }
    return true;
  }

  QUnit.test('.bind', function(assert) {
    assert.ok(document.querySelector('div.fixture.text').bind != null, '.bind function exists');
  });


  QUnit.test('.text', function(assert) {
    var ui = {};
    var div = document.querySelector('div.fixture.text');

    div.bind
      .text
      .to(ui, 'div');

    assert.equal(ui.div, "I'm a div.", "property returns text");

    ui.div = 'Hello world!';
    assert.equal(document.querySelector('div.fixture.text').innerText, "Hello world!", "assignment sets text");
  });


  QUnit.test('.html', function(assert) {
    var ui = {};
    var div = document.querySelector('div.fixture.html');

    div.bind
      .html
      .to(ui, 'html');

    assert.equal(ui.html, "<b>I'm a div with HTML.</b>", "property returns html");

    ui.html = 'Hello world!';
    assert.equal(document.querySelector('div.fixture.html').innerHTML,"Hello world!", "assignment sets html");

  });

  QUnit.test('.classList', function(assert) {
    var ui = {};
    var div = document.querySelector('div.fixture.clist');

    div.bind
      .classList
      .to(ui, 'classList');

    assert.ok(ui.classList.equals([ 'fixture', 'clist']), 'property returns classList');

    ui.classList = ['fixture', 'hello', 'world'];
    console.log(ui.classList);
    assert.ok(ui.classList.equals([ 'fixture', 'hello', 'world']), 'assignment sets classList');
  });

  QUnit.test('.hasClass', function(assert) {
    var ui = {};
    var div = document.querySelector('div.fixture.class');

    div.bind
      .hasClass('on')
      .to(ui, 'on');


    assert.equal(ui.on, true, 'property returns true if class is present');

    ui.on = false;
    assert.notOk(div.classList.contains('on'), ' false assignment removes class');

    ui.on = true;
    assert.ok(div.classList.contains('on'), ' true assignment adds class');

    div.classList.remove('on');
    assert.equal(ui.on, false, 'property returns false if class is not present');
  });


  QUnit.test('.noClass', function(assert) {
    var ui = {};
    var div = document.querySelector('div.fixture.class');

    div.bind
      .noClass('off')
      .to(ui, 'on');


    assert.equal(ui.on, true,'property returns true if class is not present');

    ui.on = false;
    assert.ok(div.classList.contains('off'), ' false assignment adds class');

    ui.on = true;
    assert.notOk(div.classList.contains('off'), ' true assignment removes class');

    div.classList.add('off');
    assert.equal(ui.on, false, 'property returns false if class is present');
  });


  QUnit.test('.attr', function(assert) {
    var ui = {};
    var div = document.querySelector('div.fixture.attr');

    div.bind
      .attr('data-color')
      .to(ui, 'color');


    assert.equal(ui.color, null, 'property returns null or undefined if attribute is not present');

    ui.color = 'red';
    assert.equal(div.getAttribute('data-color'), 'red', 'assignment changes value of attribute');
    assert.equal(ui.color, 'red', 'property returns value of attribute');
  });

  QUnit.test('.hasTruthyAttr', function(assert) {
    var ui = {};
    var div = document.querySelector('div.fixture.hattr');

    div.bind
      .hasTruthyAttr('data-display')
      .to(ui, 'display');

    assert.equal(ui.display, false, 'property returns false if attribute is not present');

    div.setAttribute('data-display', 'on');
    assert.equal(ui.display, true, 'property returns true if attribute is "yes"');

    div.setAttribute('data-display', '1');
    assert.equal(ui.display, true, 'property returns true if attribute is "1"');

    div.setAttribute('data-display', 'true');
    assert.equal(ui.display, true, 'property returns true if attribute is "true"');

    div.setAttribute('data-display', '');
    assert.equal(ui.display, true, 'property returns true if attribute is ""');

    div.setAttribute('data-display', 'no');
    assert.equal(ui.display, false, 'property returns false if attribute is "no"');

    div.setAttribute('data-display', '0');
    assert.equal(ui.display, false, 'property returns false if attribute is "0"');

    div.setAttribute('data-display', 'false');
    assert.equal(ui.display, false, 'property returns false if attribute is "false"');

    ui.display = true;
    assert.equal(ui.display, true, 'property can be set to true');
    assert.equal(div.getAttribute('data-display'), 'true', 'value of attribute is "true" when property is set to true');

    ui.display = false;
    assert.equal(ui.display, false, 'property can be set to false');
    assert.equal(div.getAttribute('data-display'), 'false', 'value of attribute is "false" when property is set to true');

  });

  QUnit.test('.noTruthyAttr', function(assert) {
    var ui = {};
    var div = document.querySelector('div.fixture.nattr');

    div.bind
      .noTruthyAttr('data-display')
      .to(ui, 'display');


    assert.equal(ui.display, true, 'property returns true if attribute is not present');

    div.setAttribute('data-display', 'on');
    assert.equal(ui.display, false, 'property returns false if attribute is "yes"');

    div.setAttribute('data-display', '1');
    assert.equal(ui.display, false, 'property returns false if attribute is "1"');

    div.setAttribute('data-display', 'true');
    assert.equal(ui.display, false, 'property returns false if attribute is "true"');

    div.setAttribute('data-display', '');
    assert.equal(ui.display, false, 'property returns true if attribute is ""');

    div.setAttribute('data-display', 'no');
    assert.equal(ui.display, true, 'property returns true if attribute is "no"');

    div.setAttribute('data-display', '0');
    assert.equal(ui.display, true, 'property returns true if attribute is "0"');

    div.setAttribute('data-display', 'false');
    assert.equal(ui.display, true, 'property returns true if attribute is "false"');

    ui.display = true;
    assert.equal(ui.display, true, 'property can be set to true');
    assert.equal(div.getAttribute('data-display'), 'false', 'value of attribute is "false" when property is set to true');

    ui.display = false;
    assert.equal(ui.display, false, 'property can be set to false');
    assert.equal(div.getAttribute('data-display'), 'true', 'value of attribute is "false" when property is set to false');
  });

  QUnit.test('.textValue', function(assert) {
    var ui = {};
    var fixtures = [ 'input.fixture[type="text"]', 'input.fixture[type="password"]', 'textarea.fixture'];

    for (var i=0; i < fixtures.length; i++) {
      var input = document.querySelector(fixtures[i]);
      input.bind
        .textValue
        .to(ui, 'text');

      assert.equal(ui.text, 'hello', 'property can be read');

      ui.text = 'bye';
      assert.equal(input.value, 'bye', 'property can be assigned');
    }

  });

  QUnit.test('.groupValue', function(assert) {
    var ui = {};
    var inputA = document.querySelector('input.fixture[type="radio"][value="A"]');
    var inputB = document.querySelector('input.fixture[type="radio"][value="B"]');

    inputA.bind
      .groupValue
      .to(ui, 'choice');

    assert.equal(ui.choice, null, "property is null when no radio buttons checked");

    ui.choice = "A";
    assert.equal(inputA.checked, true, "input is checked when its value is equal to the property value");
    assert.equal(inputB.checked, false, "input is not checked when its value is not equal to the property value");

    ui.choice = null;
    assert.equal(inputA.checked, false, "input is not checked when property value is null");
    assert.equal(inputB.checked, false, "input is not checked when property value is null");
  });

  QUnit.test('.selectValue', function(assert) {
    var ui = {};
    var select = document.querySelector('select.fixture')

    select.bind
      .selectValue
      .to(ui, 'selection');

    assert.equal(ui.selection, 'A', "property is the first value when no selection made");

    ui.selection = "A";
    assert.equal(select.value, "A", "changing property changes selection");
  });



  </script>
</head>

<body>

  <div id="qunit"></div>
  <div id="qunit-fixture">

    <!-- Div fixtures -->
    <div class="fixture text">I'm a div.</div>
    <div class="fixture html"><b>I'm a div with HTML.</b></div>
    <div class="fixture clist"></div>
    <div class="fixture class on"></div>
    <div class="fixture attr"></div>
    <div class="fixture hattr"></div>
    <div class="fixture nattr"></div>

    <!-- Text, password, textarea fixtures -->
    <input class="fixture" type="text" value="hello"></input>
    <input class="fixture" type="password" value="hello"></input>
    <textarea class="fixture">hello</textarea>

    <!-- Radio fixtures -->
    <input class="fixture" type="radio" value="A" name="choice"></input>
    <input class="fixture" type="radio" value="B" name="choice"></input>


    <!-- Select fixture -->
    <select class="fixture">
      <option>A</option>
      <option>B</option>
      <option>C</option>
    </select>
  </div>

</body>

</html>
